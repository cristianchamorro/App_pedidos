# ğŸ“ Diagramas de Arquitectura - App Pedidos

## ğŸ“Š Diagrama de Relaciones de Base de Datos (ERD)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SISTEMA DE GESTIÃ“N DE PEDIDOS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     roles        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id          â”‚
â”‚     name   (UK) â”‚â—„â”€â”
â”‚     description â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                      â”‚
                      â”‚ role_id
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   user_admin     â”‚  â”‚         â”‚   categories     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id          â”‚  â”‚         â”‚ PK  id          â”‚
â”‚     username(UK)â”‚  â”‚         â”‚     name        â”‚â—„â”€â”
â”‚     password    â”‚  â”‚         â”‚     description â”‚  â”‚
â”‚ FK  role_id     â”‚â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     name        â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ category_id
                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚     vendors      â”‚            â”‚    products      â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ PK  id          â”‚            â”‚ PK  id          â”‚ â”‚
â”‚     name        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FK  category_id â”‚â”€â”˜
â”‚ contact_phone   â”‚ vendor_id  â”‚ FK  vendor_id   â”‚
â”‚     location    â”‚            â”‚     name        â”‚
â”‚     (GPS)       â”‚            â”‚     price       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚     description â”‚
       (INDEX: location)        â”‚     image_url   â”‚â—„â”€â”
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                      â”‚
                                                      â”‚ product_id
                                                      â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                                â”‚  product_media   â”‚ â”‚
                                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
                                â”‚ PK  id          â”‚ â”‚
                                â”‚ FK  product_id  â”‚â”€â”˜
                                â”‚     media_type  â”‚
                                â”‚     media_url   â”‚
                                â”‚     description â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      users       â”‚            â”‚      orders      â”‚            â”‚     drivers      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id          â”‚            â”‚ PK  id          â”‚            â”‚ PK  id          â”‚
â”‚     phone       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FK  user_id     â”‚            â”‚     name        â”‚
â”‚     name        â”‚  user_id   â”‚ FK  driver_id   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     phone       â”‚
â”‚     address     â”‚            â”‚     total       â”‚  driver_id â”‚     location    â”‚
â”‚     location    â”‚            â”‚     status      â”‚            â”‚     (GPS)       â”‚
â”‚     (GPS)       â”‚            â”‚ order_channel   â”‚            â”‚     status      â”‚
â”‚     created_at  â”‚            â”‚     created_at  â”‚            â”‚     updated_at  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (INDEX: location)                   â”‚                           (INDEX: location)
                                        â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚                       â”‚
                            â†“                       â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   order_items    â”‚    â”‚  status_history  â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                  â”‚ PK  id          â”‚    â”‚ PK  id          â”‚
                  â”‚ FK  order_id    â”‚    â”‚ FK  order_id    â”‚
                  â”‚ FK  product_id  â”‚â”€â”€â”€â”€â”‚     status      â”‚
                  â”‚     quantity    â”‚    â”‚ FK  changed_by  â”‚â”€â”€â–º user_admin.id
                  â”‚     price       â”‚    â”‚     changed_at  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ product_id
                           â”‚
                           â†“
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    products      â”‚
                  â”‚   (referencia)   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  order_status    â”‚  (Tabla de referencia)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK  id          â”‚
â”‚     status (UK) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Estados vÃ¡lidos:
  â€¢ pendiente
  â€¢ pagado
  â€¢ preparando
  â€¢ listo
  â€¢ entregado
  â€¢ cancelado
```

---

## ğŸ—ï¸ Arquitectura del Sistema (3 Capas)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CAPA DE PRESENTACIÃ“N                        â”‚
â”‚                                  (Flutter)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Cliente   â”‚  â”‚   Cajero    â”‚  â”‚  Cocinero   â”‚  â”‚Domiciliario â”‚   â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚   â”‚
â”‚  â”‚ â€¢ UbicaciÃ³n â”‚  â”‚ â€¢ Pagos     â”‚  â”‚â€¢ Preparar   â”‚  â”‚â€¢ Entregas   â”‚   â”‚
â”‚  â”‚ â€¢ Productos â”‚  â”‚ â€¢ Reportes  â”‚  â”‚â€¢ Marcar     â”‚  â”‚â€¢ GPS Track  â”‚   â”‚
â”‚  â”‚ â€¢ Carrito   â”‚  â”‚ â€¢ EstadÃ­s.  â”‚  â”‚  Listo      â”‚  â”‚â€¢ Estado     â”‚   â”‚
â”‚  â”‚ â€¢ Pedido    â”‚  â”‚ â€¢ Historial â”‚  â”‚â€¢ Notific.   â”‚  â”‚â€¢ Historial  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                         â”‚
â”‚  â”‚ API Service â”‚  (http package)                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ HTTP/JSON
          â”‚ REST API
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CAPA DE APLICACIÃ“N                             â”‚
â”‚                         (Node.js + Express)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         RUTAS (Routes)                           â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  /productos      /pedidos       /admin        /drivers          â”‚   â”‚
â”‚  â”‚  /cajero         /loginAdmin    /admin/...                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                              â”‚
â”‚                           â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CONTROLADORES (Controllers)                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ productosController    â†’ CatÃ¡logo de productos               â”‚   â”‚
â”‚  â”‚  â€¢ pedidosController      â†’ CreaciÃ³n y gestiÃ³n de pedidos       â”‚   â”‚
â”‚  â”‚  â€¢ adminController        â†’ AutenticaciÃ³n                       â”‚   â”‚
â”‚  â”‚  â€¢ adminProductsControllerâ†’ CRUD de productos                   â”‚   â”‚
â”‚  â”‚  â€¢ adminDataController    â†’ CategorÃ­as y vendors                â”‚   â”‚
â”‚  â”‚  â€¢ cajeroController       â†’ Reportes y estadÃ­sticas             â”‚   â”‚
â”‚  â”‚  â€¢ driversController      â†’ GestiÃ³n de domiciliarios            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  LÃ³gica de negocio:                                             â”‚   â”‚
â”‚  â”‚  â€¢ Validaciones                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Transacciones SQL                                            â”‚   â”‚
â”‚  â”‚  â€¢ AsignaciÃ³n de drivers (PostGIS)                              â”‚   â”‚
â”‚  â”‚  â€¢ Cambios de estado                                            â”‚   â”‚
â”‚  â”‚  â€¢ CÃ¡lculos de totales                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                              â”‚
â”‚                           â†“                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    CAPA DE ACCESO A DATOS                        â”‚   â”‚
â”‚  â”‚                        (Pool de pg)                              â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  â€¢ pool.query(sql, params)                                      â”‚   â”‚
â”‚  â”‚  â€¢ Transacciones (BEGIN/COMMIT/ROLLBACK)                        â”‚   â”‚
â”‚  â”‚  â€¢ Connection pooling                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ SQL/PostgreSQL Protocol
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CAPA DE PERSISTENCIA                            â”‚
â”‚                      (PostgreSQL 17.6 + PostGIS)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                       BASE DE DATOS: Bd_App                      â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ“Š Tablas Principales:                                         â”‚   â”‚
â”‚  â”‚  â€¢ users, user_admin, roles                                     â”‚   â”‚
â”‚  â”‚  â€¢ products, categories, vendors, product_media                 â”‚   â”‚
â”‚  â”‚  â€¢ orders, order_items, order_status                            â”‚   â”‚
â”‚  â”‚  â€¢ drivers                                                      â”‚   â”‚
â”‚  â”‚  â€¢ status_history                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ—ºï¸  PostGIS Extensions:                                        â”‚   â”‚
â”‚  â”‚  â€¢ GEOGRAPHY(Point, 4326) para ubicaciones GPS                  â”‚   â”‚
â”‚  â”‚  â€¢ Ãndices GIST para bÃºsquedas espaciales                       â”‚   â”‚
â”‚  â”‚  â€¢ Operador de distancia (<->)                                  â”‚   â”‚
â”‚  â”‚  â€¢ ST_MakePoint, ST_SetSRID                                     â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  ğŸ”’ Constraints y Relaciones:                                   â”‚   â”‚
â”‚  â”‚  â€¢ Foreign Keys con CASCADE                                     â”‚   â”‚
â”‚  â”‚  â€¢ UNIQUE constraints                                           â”‚   â”‚
â”‚  â”‚  â€¢ Primary Keys (SERIAL)                                        â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚  âš¡ Optimizaciones:                                              â”‚   â”‚
â”‚  â”‚  â€¢ FOR UPDATE SKIP LOCKED (concurrencia)                        â”‚   â”‚
â”‚  â”‚  â€¢ Transacciones ACID                                           â”‚   â”‚
â”‚  â”‚  â€¢ Ãndices espaciales                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de CreaciÃ³n de Pedido (Secuencia Completa)

```
â”Œâ”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Clienteâ”‚        â”‚ Flutter  â”‚       â”‚ Backend â”‚      â”‚PostgreSQLâ”‚      â”‚ PostGIS  â”‚
â”‚ App  â”‚        â”‚   App    â”‚       â”‚ Express â”‚      â”‚          â”‚      â”‚  Engine  â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚ 1. Selecciona  â”‚                   â”‚                â”‚                 â”‚
    â”‚    productos   â”‚                   â”‚                â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚ 2. Obtiene GPS â”‚                   â”‚                â”‚                 â”‚
    â”‚    Location    â”‚                   â”‚                â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚ 3. Confirma    â”‚                   â”‚                â”‚                 â”‚
    â”‚    Pedido      â”‚                   â”‚                â”‚                 â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚ POST /pedidos     â”‚                â”‚                 â”‚
    â”‚                â”‚  {nombre, tel,    â”‚                â”‚                 â”‚
    â”‚                â”‚   direccion,      â”‚                â”‚                 â”‚
    â”‚                â”‚   ubicacion,      â”‚                â”‚                 â”‚
    â”‚                â”‚   productos}      â”‚                â”‚                 â”‚
    â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ BEGIN          â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ SELECT user    â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ INSERT/UPDATE  â”‚                 â”‚
    â”‚                â”‚                   â”‚    user        â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ SELECT driver  â”‚                 â”‚
    â”‚                â”‚                   â”‚ mÃ¡s cercano    â”‚  Calcula        â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  distancias     â”‚
    â”‚                â”‚                   â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚  Devuelve mÃ¡s   â”‚
    â”‚                â”‚                   â”‚                â”‚  cercano        â”‚
    â”‚                â”‚                   â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ UPDATE driver  â”‚                 â”‚
    â”‚                â”‚                   â”‚  status='busy' â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ INSERT order   â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ INSERT items   â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ INSERT history â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚ COMMIT         â”‚                 â”‚
    â”‚                â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚ Response 201      â”‚                â”‚                 â”‚
    â”‚                â”‚  {success: true,  â”‚                â”‚                 â”‚
    â”‚                â”‚   order_id: 42,   â”‚                â”‚                 â”‚
    â”‚                â”‚   driver_id: 3}   â”‚                â”‚                 â”‚
    â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
    â”‚ 4. Mensaje     â”‚                   â”‚                â”‚                 â”‚
    â”‚    "Pedido     â”‚                   â”‚                â”‚                 â”‚
    â”‚    creado #42" â”‚                   â”‚                â”‚                 â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚                â”‚                 â”‚
    â”‚                â”‚                   â”‚                â”‚                 â”‚
```

---

## ğŸ³ Flujo de Procesamiento de Pedido (Estados)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CICLO DE VIDA DEL PEDIDO                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    [CLIENTE]                    [CAJERO]                 [COCINERO]
        â”‚                            â”‚                         â”‚
        â”‚ Crea pedido                â”‚                         â”‚
        â”‚ POST /pedidos              â”‚                         â”‚
        â†“                            â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚                         â”‚
â”‚   PENDIENTE    â”‚                   â”‚                         â”‚
â”‚  (created)     â”‚                   â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                         â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚ Confirma pago           â”‚
        â”‚                            â”‚ PUT /pedidos/:id/pago   â”‚
        â”‚                            â†“                         â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
        â”‚                    â”‚     PAGADO     â”‚               â”‚
        â”‚                    â”‚                â”‚               â”‚
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚                         â”‚ Inicia preparaciÃ³n
        â”‚                            â”‚                         â”‚ PUT /pedidos/:id/preparar
        â”‚                            â”‚                         â†“
        â”‚                            â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                 â”‚  PREPARANDO    â”‚
        â”‚                            â”‚                 â”‚  (En cocina)   â”‚
        â”‚                            â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚                         â”‚ Marca listo
        â”‚                            â”‚                         â”‚ PUT /pedidos/:id/listo
        â”‚                            â”‚                         â†“
        â”‚                            â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚                 â”‚     LISTO      â”‚
        â”‚                            â”‚                 â”‚ (Para entregar)â”‚
        â”‚                            â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚                         â”‚
        â”‚                                                      â”‚
        â”‚                      [DOMICILIARIO]                  â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚ Recoge pedido           â”‚
        â”‚                            â”‚ POST .../picked-up      â”‚
        â”‚                            â†“                         â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
        â”‚                    â”‚  (picked_up)   â”‚               â”‚
        â”‚                    â”‚   en history   â”‚               â”‚
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚ En camino               â”‚
        â”‚                            â”‚ POST .../on-route       â”‚
        â”‚                            â†“                         â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
        â”‚                    â”‚  (on_route)    â”‚               â”‚
        â”‚                    â”‚   en history   â”‚               â”‚
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚ Entrega                 â”‚
        â”‚                            â”‚ POST .../delivered      â”‚
        â”‚                            â†“                         â”‚
        â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
        â”‚                    â”‚   ENTREGADO    â”‚               â”‚
        â”‚                    â”‚   (Completo)   â”‚               â”‚
        â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                            â”‚                         â”‚
        â”‚                            â”‚ Driver â†’ available      â”‚
        â”‚                            â†“                         â”‚
        â”‚                      [FIN DEL CICLO]                 â”‚
        â”‚                                                      â”‚
        â”‚                                                      â”‚
        â”‚           En cualquier momento:                      â”‚
        â”‚                   â†“                                  â”‚
        â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
        â”‚            â”‚   CANCELADO    â”‚                        â”‚
        â”‚            â”‚                â”‚                        â”‚
        â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
```

---

## ğŸ—ºï¸ Sistema de AsignaciÃ³n Geoespacial

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ASIGNACIÃ“N INTELIGENTE DE DOMICILIARIOS (PostGIS)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Escenario: Cliente en ubicaciÃ³n (4.6097, -74.0817) hace pedido


  1. Cliente                                 2. Backend consulta PostGIS
     â””â”€ UbicaciÃ³n: (4.6097, -74.0817)           â””â”€ Busca domiciliario mÃ¡s cercano

                                                        ğŸ—ºï¸ PostGIS
                                                            â”‚
                                                            â”‚ ORDER BY location <->
                                                            â”‚ ST_MakePoint(lng, lat)
                                                            â†“
                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                    â”‚  CÃ¡lculo de   â”‚
                                                    â”‚  distancias   â”‚
                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                   Mapa de la ciudad                        â”‚
                                                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                            â”‚
    â”‚                       ğŸª Restaurante                       â”‚
    â”‚                          (origen)                          â”‚
    â”‚                            â†‘                               â”‚
    â”‚                            â”‚                               â”‚
    â”‚                      Pedido listo                          â”‚
    â”‚                            â”‚                               â”‚
    â”‚            Domiciliario 3  â”‚  Domiciliario 1              â”‚
    â”‚                ğŸš´ (2.1km) â”‚    ğŸš´ (5.3km)                 â”‚
    â”‚                  âœ…        â”‚      âŒ                        â”‚
    â”‚               disponible   â”‚    ocupado                    â”‚
    â”‚                            â”‚                               â”‚
    â”‚                            â”‚                               â”‚
    â”‚                            â†“                               â”‚
    â”‚                       ğŸ“ Cliente                           â”‚
    â”‚                     (4.6097, -74.0817)                     â”‚
    â”‚                            â†‘                               â”‚
    â”‚                            â”‚                               â”‚
    â”‚                     3.8km (ocupado)                        â”‚
    â”‚                            â”‚                               â”‚
    â”‚                    Domiciliario 2                          â”‚
    â”‚                         ğŸš´ (3.8km)                         â”‚
    â”‚                           âŒ                                â”‚
    â”‚                        ocupado                             â”‚
    â”‚                                                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  3. Resultado de la consulta:

     SELECT id, name,
            ST_Distance(location, ST_SetSRID(ST_MakePoint(-74.0817, 4.6097), 4326)) as distance
     FROM drivers
     WHERE status = 'available'
     ORDER BY distance
     LIMIT 1
     FOR UPDATE SKIP LOCKED;

     â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ id â”‚      name        â”‚  status   â”‚  distance(m) â”‚
     â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 3  â”‚ Juan PÃ©rez       â”‚ available â”‚   2100       â”‚  â† SELECCIONADO âœ…
     â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  4. AsignaciÃ³n:
     - Driver 3 asignado al pedido
     - Status cambiado a 'busy'
     - Pedido asociado en orders.driver_id = 3


  5. Beneficios:
     âœ… Menor tiempo de entrega
     âœ… Menor distancia recorrida
     âœ… OptimizaciÃ³n de recursos
     âœ… Mejor experiencia del cliente
```

---

## ğŸ” Sistema de Roles y Permisos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ROLES Y PERMISOS DEL SISTEMA                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              user_admin
                                  â”‚
                                  â”‚ role_id
                                  â†“
                              â”Œâ”€â”€â”€â”€â”€â”€â”
                              â”‚ rolesâ”‚
                              â””â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚         â”‚                    â”‚
        â†“                    â†“         â†“                    â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ CAJERO â”‚          â”‚COCINEROâ”‚ â”‚ ADMIN  â”‚        â”‚DOMICILIARIOâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚         â”‚                    â”‚
        â”‚                    â”‚         â”‚                    â”‚
        â†“                    â†“         â†“                    â†“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PERMISOS     â”‚  â”‚   PERMISOS     â”‚  â”‚    PERMISOS     â”‚  â”‚    PERMISOS      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚âœ… Ver pedidos  â”‚  â”‚âœ… Ver pedidos  â”‚  â”‚âœ… Todo acceso   â”‚  â”‚âœ… Ver pedidos    â”‚
â”‚  pendientes    â”‚  â”‚  pagados       â”‚  â”‚                 â”‚  â”‚  asignados       â”‚
â”‚                â”‚  â”‚                â”‚  â”‚âœ… CRUD productosâ”‚  â”‚                  â”‚
â”‚âœ… Confirmar    â”‚  â”‚âœ… Marcar       â”‚  â”‚                 â”‚  â”‚âœ… Actualizar GPS â”‚
â”‚  pagos         â”‚  â”‚  preparando    â”‚  â”‚âœ… CRUD usuarios â”‚  â”‚                  â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚âœ… Marcar estados â”‚
â”‚âœ… Ver reportes â”‚  â”‚âœ… Marcar listo â”‚  â”‚âœ… Ver reportes  â”‚  â”‚  picked-up       â”‚
â”‚  de ventas     â”‚  â”‚                â”‚  â”‚  completos      â”‚  â”‚  on-route        â”‚
â”‚                â”‚  â”‚âœ… Recibir      â”‚  â”‚                 â”‚  â”‚  delivered       â”‚
â”‚âœ… Ver          â”‚  â”‚  notificacionesâ”‚  â”‚âœ… GestiÃ³n de    â”‚  â”‚                  â”‚
â”‚  estadÃ­sticas  â”‚  â”‚  sonoras       â”‚  â”‚  roles          â”‚  â”‚âœ… Ver historial  â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚                  â”‚
â”‚âœ… Historial de â”‚  â”‚âœ… Ver historialâ”‚  â”‚âœ… ConfiguraciÃ³n â”‚  â”‚âœ… Cambiar estado â”‚
â”‚  transacciones â”‚  â”‚                â”‚  â”‚  del sistema    â”‚  â”‚  (disponible/    â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚   offline)       â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚                  â”‚
â”‚âŒ Preparar     â”‚  â”‚âŒ Confirmar    â”‚  â”‚âœ… Todo lo demÃ¡s â”‚  â”‚âŒ Ver reportes   â”‚
â”‚  pedidos       â”‚  â”‚  pagos         â”‚  â”‚                 â”‚  â”‚                  â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚âŒ Confirmar pagosâ”‚
â”‚âŒ Entregar     â”‚  â”‚âŒ Entregar     â”‚  â”‚                 â”‚  â”‚                  â”‚
â”‚  pedidos       â”‚  â”‚  pedidos       â”‚  â”‚                 â”‚  â”‚âŒ Preparar       â”‚
â”‚                â”‚  â”‚                â”‚  â”‚                 â”‚  â”‚  pedidos         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


FLUJO DE AUTENTICACIÃ“N:

  Usuario â†’ LoginAdminPage â†’ POST /loginAdmin
                                    â”‚
                                    â†“
                              Valida credenciales
                                    â”‚
                                    â†“
                            Devuelve role
                                    â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                   â”‚                   â”‚
                â†“                   â†“                   â†“
         /cajero            /cocinero           /domiciliario
    (PedidosCajeroPage)(PedidosCocineroPage)(DomiciliarioPage)
```

---

## ğŸ’¾ Arquitectura de Almacenamiento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTRATEGIA DE ALMACENAMIENTO                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DATOS TRANSACCIONALES                              â”‚
â”‚                           (PostgreSQL Tables)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“¦ orders, order_items                                                     â”‚
â”‚     â”œâ”€ Datos de pedidos actuales                                           â”‚
â”‚     â”œâ”€ Relaciones con usuarios y productos                                 â”‚
â”‚     â””â”€ Claves forÃ¡neas con CASCADE                                         â”‚
â”‚                                                                             â”‚
â”‚  ğŸ‘¥ users, user_admin                                                       â”‚
â”‚     â”œâ”€ InformaciÃ³n de clientes                                             â”‚
â”‚     â”œâ”€ Credenciales de administradores                                     â”‚
â”‚     â””â”€ Datos de contacto                                                   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ›ï¸  products, categories, vendors                                          â”‚
â”‚     â”œâ”€ CatÃ¡logo de productos                                               â”‚
â”‚     â”œâ”€ Precios actuales                                                    â”‚
â”‚     â””â”€ ClasificaciÃ³n y origen                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATOS HISTÃ“RICOS                                  â”‚
â”‚                       (AuditorÃ­a y AnÃ¡lisis)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“œ status_history                                                          â”‚
â”‚     â”œâ”€ Registro completo de cambios de estado                              â”‚
â”‚     â”œâ”€ QuiÃ©n hizo el cambio (changed_by)                                   â”‚
â”‚     â”œâ”€ CuÃ¡ndo se hizo (changed_at)                                         â”‚
â”‚     â””â”€ Permite auditorÃ­a y anÃ¡lisis de tiempos                             â”‚
â”‚                                                                             â”‚
â”‚  ğŸ’° order_items (con precio histÃ³rico)                                     â”‚
â”‚     â”œâ”€ Precio al momento de la venta                                       â”‚
â”‚     â””â”€ Inmutable despuÃ©s de creaciÃ³n                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATOS GEOESPACIALES                                 â”‚
â”‚                         (PostGIS Geography)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“ users.location                                                          â”‚
â”‚     â””â”€ UbicaciÃ³n GPS del cliente para entrega                              â”‚
â”‚                                                                             â”‚
â”‚  ğŸš´ drivers.location                                                        â”‚
â”‚     â”œâ”€ UbicaciÃ³n en tiempo real del domiciliario                           â”‚
â”‚     â””â”€ Actualizada periÃ³dicamente                                          â”‚
â”‚                                                                             â”‚
â”‚  ğŸª vendors.location                                                        â”‚
â”‚     â””â”€ UbicaciÃ³n fija del restaurante/proveedor                            â”‚
â”‚                                                                             â”‚
â”‚  Ãndices: GIST indexes para bÃºsquedas espaciales eficientes                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATOS MULTIMEDIA                                    â”‚
â”‚                      (Base64 y URLs externas)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ–¼ï¸  products.image_url                                                     â”‚
â”‚     â”œâ”€ URL externa (recomendado para producciÃ³n)                           â”‚
â”‚     â””â”€ Base64 (para desarrollo/demo)                                       â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“¸ product_media                                                           â”‚
â”‚     â”œâ”€ MÃºltiples imÃ¡genes por producto                                     â”‚
â”‚     â”œâ”€ Soporte para videos (media_type)                                    â”‚
â”‚     â””â”€ Almacenamiento flexible (URL o base64)                              â”‚
â”‚                                                                             â”‚
â”‚  Nota: Para producciÃ³n se recomienda usar CDN o S3                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Patrones de DiseÃ±o Implementados

### 1. Repository Pattern (ImplÃ­cito)
```
Controllers â†’ Pool (pg) â†’ PostgreSQL
(LÃ³gica)     (Acceso)    (Persistencia)
```

### 2. MVC Pattern
```
Models      â†’ Definidos implÃ­citamente en esquema SQL
Views       â†’ Flutter UI Components
Controllers â†’ Express Controllers
```

### 3. Transaction Script
```javascript
// Operaciones complejas envueltas en transacciones
BEGIN
  INSERT user
  SELECT available driver
  UPDATE driver status
  INSERT order
  INSERT order_items
  INSERT status_history
COMMIT
```

### 4. Optimistic Locking (con PostGIS)
```sql
-- FOR UPDATE SKIP LOCKED evita bloqueos
SELECT id FROM drivers
WHERE status='available'
FOR UPDATE SKIP LOCKED
```

---

## ğŸ“ˆ Escalabilidad y Performance

### Optimizaciones Actuales

1. **Connection Pooling**
   - Pool de conexiones PostgreSQL
   - ReutilizaciÃ³n de conexiones
   - Manejo eficiente de concurrencia

2. **Ãndices Espaciales**
   - GIST indexes en campos de geografÃ­a
   - BÃºsquedas O(log n) en lugar de O(n)

3. **Consultas Agregadas**
   - JSON_AGG para productos en pedidos
   - Reduce nÃºmero de queries

4. **Transacciones AtÃ³micas**
   - Previene estados inconsistentes
   - Garantiza integridad de datos

### Recomendaciones para Escalar

1. **Cache Layer**
   - Redis para productos frecuentes
   - Cache de ubicaciones de drivers

2. **Load Balancing**
   - MÃºltiples instancias de backend
   - Nginx como reverse proxy

3. **Read Replicas**
   - PostgreSQL read replicas para reportes
   - Separar lectura de escritura

4. **CDN para ImÃ¡genes**
   - S3 + CloudFront
   - Reduce carga en backend

---

**Fin de Diagramas de Arquitectura**
